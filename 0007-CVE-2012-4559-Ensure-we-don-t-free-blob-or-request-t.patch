From 1471f2c67a23602898e783c97b65aea9cc6356a4 Mon Sep 17 00:00:00 2001
From: Andreas Schneider <asn@cryptomilk.org>
Date: Fri, 5 Oct 2012 14:33:29 +0200
Subject: [PATCH 07/13] CVE-2012-4559: Ensure we don't free blob or request
 twice.


Signed-off-by: Andreas Schneider <asn@cryptomilk.org>
---
 src/agent.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/agent.c b/src/agent.c
index c3d13c8..5b0dba0 100644
--- a/src/agent.c
+++ b/src/agent.c
@@ -439,6 +439,7 @@ ssh_string agent_sign_data(struct ssh_session_struct *session,
   }
 
   ssh_string_free(blob);
+  blob = NULL;
 
   reply = ssh_buffer_new();
   if (reply == NULL) {
@@ -451,6 +452,7 @@ ssh_string agent_sign_data(struct ssh_session_struct *session,
     return NULL;
   }
   ssh_buffer_free(request);
+  request = NULL;
 
   /* check if reply is valid */
   if (buffer_get_u8(reply, (uint8_t *) &type) != sizeof(uint8_t)) {
-- 
1.8.0

