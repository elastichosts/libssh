Description: Handle packet timeouts properly (speed improvement)
Author: Oleksandr Shneyder <o.schneyder@phoca-gmbh.de>
Origin: http://git.libssh.org/projects/libssh.git/commit/?id=d90478448985a1e21cc240fd87fc5a14b4bb978a
--- a/src/channels.c
+++ b/src/channels.c
@@ -1769,7 +1769,11 @@
 
   for (t = timeout_ms; t >= 0; t -= 50)
   {
-    ssh_handle_packets(session, 50);
+    if (timeout_ms == 0) {
+        ssh_handle_packets(session, 0);
+    } else {
+        ssh_handle_packets(session, 50);
+    }
 
     if (session->ssh_message_list) {
       iterator = ssh_list_get_iterator(session->ssh_message_list);
